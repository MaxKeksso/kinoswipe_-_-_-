# Решение проблемы "role kinoswipe does not exist"

## Проблема

Скрипты не могут подключиться к PostgreSQL, потому что на порту 5432 работает другой PostgreSQL (не из Docker).

## Решение 1: Проверить, что слушает на порту 5432

```bash
# Проверить, что слушает на 5432
lsof -i :5432

# Или
netstat -an | grep 5432
```

Если видите процесс `postgres` (не из Docker), остановите его:

```bash
# Найти процесс
ps aux | grep postgres

# Остановить (замените PID на реальный)
kill <PID>
```

## Решение 2: Использовать другой порт для Docker PostgreSQL

Измените `docker-compose.yml`:

```yaml
postgres:
  ports:
    - "5433:5432"  # Внешний порт 5433, внутренний 5432
```

Затем пересоздайте контейнер:

```bash
docker-compose down postgres
docker-compose up -d postgres
```

И запускайте скрипты с портом 5433:

```bash
DATABASE_URL="postgres://kinoswipe:kinoswipe123@localhost:5433/kinoswipe?sslmode=disable" go run -tags createadmin ./scripts/
DATABASE_URL="postgres://kinoswipe:kinoswipe123@localhost:5433/kinoswipe?sslmode=disable" go run -tags loadmovies ./scripts/
```

## Решение 3: Подключиться через Docker exec (если контейнер работает)

```bash
# Создать админа через Docker
docker exec -i kinoswipe_db psql -U kinoswipe -d kinoswipe <<EOF
INSERT INTO users (id, username, email, password_hash, user_type, created_at, updated_at)
VALUES (gen_random_uuid(), 'Администратор', 'admin@kinoswipe.ru', '\$2a\$10\$lTD5HwNkoIUQ9ICK9dR2j.5Y27xJApTozrSdm7shAFGaxCBBsgYXm', 'admin', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
ON CONFLICT (email) DO UPDATE SET password_hash = EXCLUDED.password_hash;
EOF
```

## Решение 4: Пересоздать контейнер с чистым volume

```bash
# Остановить и удалить контейнер с данными
docker-compose down -v postgres

# Запустить заново (создаст нового пользователя kinoswipe)
docker-compose up -d postgres

# Подождать 10 секунд для инициализации
sleep 10

# Запустить скрипты
go run -tags createadmin ./scripts/
go run -tags loadmovies ./scripts/
```

## Проверка подключения

```bash
# Проверить, что контейнер работает
docker ps | grep kinoswipe_db

# Проверить логи контейнера
docker logs kinoswipe_db

# Подключиться напрямую
docker exec -it kinoswipe_db psql -U kinoswipe -d kinoswipe
```
