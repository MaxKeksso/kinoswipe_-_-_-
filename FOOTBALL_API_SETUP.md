# Настройка Football API для автоматического обновления матчей

## Обзор

Приложение интегрировано с **Football-Data.org API** для автоматического получения данных о футбольных матчах. Система автоматически обновляет данные каждые 5 минут.

## Источники данных

### Football-Data.org (Основной источник)

**Бесплатный план:**
- Доступ к основным лигам (Premier League, La Liga, Bundesliga, Serie A, Ligue 1)
- Лига Чемпионов (Champions League)
- Лига Европы (Europa League)
- Ограничение: 10 запросов в минуту
- Обновления с задержкой 1-2 минуты

**Платный план:**
- Больше лиг (включая РПЛ при наличии)
- Реал-тайм обновления
- Больше запросов в минуту

### РПЛ (Российская Премьер-Лига)

Football-Data.org не предоставляет РПЛ в бесплатном плане. В текущей реализации используются статические данные с динамическими датами. Для получения реальных данных РПЛ можно:

1. Использовать альтернативные API (например, API-Football.com)
2. Интегрировать скрапинг с официальных сайтов
3. Использовать платный план Football-Data.org (если доступен)

## Настройка API ключа

### 1. Получение API ключа

1. Зарегистрируйтесь на [Football-Data.org](https://www.football-data.org/)
2. Перейдите в раздел "API" → "Get API Token"
3. Скопируйте ваш API ключ

### 2. Установка переменной окружения

#### Локально (в `.env` файле):

```bash
FOOTBALL_API_KEY=your_api_key_here
```

#### На Railway:

1. Откройте ваш проект на Railway
2. Перейдите в сервис `kinoswipe`
3. Откройте вкладку "Variables"
4. Нажмите "+ New Variable"
5. Добавьте:
   - **Name:** `FOOTBALL_API_KEY`
   - **Value:** ваш API ключ
6. Нажмите "Add"
7. Railway автоматически пересоберет проект

### 3. Без API ключа

Если API ключ не указан, приложение будет работать с ограничениями:
- Использует бесплатный доступ (если доступен)
- Для РПЛ используются статические данные
- Для европейских турниров попытка получить данные из API, при ошибке - статические данные

## API Endpoints

### Получить все матчи

```
GET /api/v1/football/matches
```

Возвращает:
```json
{
  "rpl": [
    {
      "id": "rpl-1",
      "date": "2026-02-20",
      "time": "20:00",
      "homeTeam": "Спартак",
      "awayTeam": "Зенит",
      "tournament": "РПЛ",
      "status": "upcoming"
    }
  ],
  "european": [
    {
      "id": "cl-1",
      "date": "2026-02-18",
      "time": "22:00",
      "homeTeam": "Реал Мадрид",
      "awayTeam": "Манчестер Сити",
      "tournament": "Лига Чемпионов",
      "status": "upcoming"
    }
  ]
}
```

### Получить матчи конкретной лиги

```
GET /api/v1/football/matches?league=RPL
GET /api/v1/football/matches?league=CL
GET /api/v1/football/matches?league=EU
```

### Принудительно обновить кеш

```
POST /api/v1/football/refresh
```

## Кеширование

Система использует кеширование для оптимизации:
- **TTL кеша:** 5 минут
- **Автоматическое обновление:** каждые 5 минут на фронтенде
- **Принудительное обновление:** через endpoint `/football/refresh`

## Альтернативные источники данных

Если нужны данные РПЛ в реальном времени, можно интегрировать:

1. **API-Football.com** - предоставляет РПЛ, но требует платный план
2. **RapidAPI** - агрегатор различных спортивных API
3. **Скрапинг** - парсинг официальных сайтов (требует осторожности с ToS)

## Обновление данных

### Автоматическое обновление

- Фронтенд автоматически запрашивает данные каждые 5 минут
- Бэкенд кеширует данные на 5 минут для оптимизации

### Ручное обновление

Пользователи могут обновить страницу для получения свежих данных.

## Статусы матчей

- `upcoming` - Предстоящий матч
- `live` - Матч в прямом эфире
- `finished` - Завершенный матч

## Обработка ошибок

При ошибке получения данных из API:
- Для РПЛ: используются статические данные с динамическими датами
- Для европейских турниров: используются статические данные
- Пользователю показывается сообщение об ошибке (если не удалось загрузить данные)

## Мониторинг

Для мониторинга работы API можно проверить логи:
- Railway: Deploy Logs
- Локально: вывод в консоль сервера

## Дальнейшие улучшения

1. Добавить поддержку других лиг
2. Интегрировать альтернативные источники для РПЛ
3. Добавить уведомления о начале матчей
4. Добавить статистику матчей
5. Добавить результаты завершенных матчей
