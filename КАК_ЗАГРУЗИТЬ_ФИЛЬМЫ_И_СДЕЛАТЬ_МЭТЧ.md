# Как загрузить фильмы и сделать мэтч

Чтобы в приложении были фильмы для свайпов, мэтчей и библиотеки, их нужно один раз загрузить в БД.

## Один шаг

Из **корня проекта** в терминале выполни:

```bash
./импорт_csv.sh
```

Скрипт сам скачает файл IMDB Top 1000 (если его ещё нет) и импортирует фильмы в таблицу `movies`. Нужны:
- подключение к БД (в `.env` задан `DATABASE_URL`, как для миграций);
- применённые миграции (таблица `movies` уже есть).

После импорта:
- **Библиотека** (кнопка «Библиотека» в приложении) покажет все загруженные фильмы.
- **Свайпы в комнате** — при входе в комнату и старте подборки подгружаются те же фильмы из БД (которые ты ещё не свайпал в этой комнате).
- **Мэтч** — когда все участники комнаты лайкнут один и тот же фильм, появится экран «У вас мэтч» со ссылками, где посмотреть.

Если фильмов по-прежнему 0, открой «Библиотека» в приложении — там будет подсказка с командой импорта.

---

## В pgAdmin фильмы есть, а в приложении (библиотеке) — 0

Приложение подключается к **той БД, на которую смотрит бэкенд**. Если ты открываешь **kinoswipe-production.up.railway.app**, то фильмы берутся из **базы Railway** (прод), а не из той, что открыта в твоём pgAdmin.

- **Чтобы фильмы появились в продакшене (на сайте Railway):**  
  1. В Railway открой проект (например **successful-perception**) → сервис **Postgres** (не kinoswipe) → вкладка **Variables** или **Connect** → скопируй **Public URL** / **DATABASE_PUBLIC_URL** (строка `postgres://...`).
  2. В терминале из корня проекта выполни (подставь скопированный URL):
  ```bash
  export DATABASE_URL="postgres://postgres:ПАРОЛЬ@хост:порт/railway"
  ./применить_миграции.sh
  ./импорт_csv.sh
  ```
  Сначала миграции создают таблицы в прод-БД, затем импорт загружает фильмы. После этого библиотека на сайте начнёт их показывать.

- **Если хочешь смотреть фильмы только локально:**  
  Запускай приложение локально (`docker-compose up` или фронт на localhost:3000, бэкенд на 8080) и импортируй в локальную БД (как обычно, с `DATABASE_URL` из `.env`). Тогда в браузере открывай **http://localhost:3000**, а не Railway.

---

## Картинки (постеры) у фильмов

В CSV IMDB Top 1000 есть колонка **Poster_Link** — при импорте она записывается в `poster_url`. То есть постеры уже подтягиваются из файла, если в нём есть ссылки.

Если у части фильмов постеров нет (пустой `poster_url`), можно один раз подставить их скриптом (см. ниже в корне: `обновить_постеры.sh` и `cmd/update_posters`).
