# Инструкция по проверке Football API

## Шаги для проверки работы API

### 1. Проверка переменной окружения

Убедитесь, что переменная `FOOTBALL_API_KEY` установлена на Railway:

1. Откройте Railway → ваш проект → сервис `kinoswipe`
2. Перейдите в "Variables"
3. Проверьте наличие `FOOTBALL_API_KEY`
4. Если нет - добавьте ваш API ключ от Football-Data.org

### 2. Проверка логов на Railway

После деплоя проверьте логи:

1. Откройте Railway → ваш проект → сервис `kinoswipe`
2. Перейдите в "Deploy Logs" или "Observability" → "Logs"
3. Найдите сообщения вида:
   - `Fetching matches from API: https://api.football-data.org/v4/...`
   - `API response status: 200`
   - `Parsed X matches from API`
   - `Filtered to X upcoming matches`

### 3. Проверка через браузер

Откройте в браузере (замените URL на ваш):

```
https://your-app.up.railway.app/api/v1/football/matches
```

Должен вернуться JSON с матчами:
```json
{
  "rpl": [...],
  "european": [...]
}
```

### 4. Проверка на фронтенде

1. Откройте сайт: `https://your-app.up.railway.app`
2. Перейдите на страницу "⚽ Футбол"
3. Откройте консоль браузера (F12 → Console)
4. Должны увидеть сообщения:
   - `Loading football matches from API...`
   - `Received response: {...}`
   - `Loaded X RPL matches`
   - `Loaded X European matches`

### 5. Проверка реальных данных

**Ожидаемое поведение:**

- **Европейские турниры (справа):**
  - Должны отображаться реальные матчи из Лиги Чемпионов
  - Даты должны быть актуальными (ближайшие 30 дней)
  - Названия команд должны быть реальными (например, "Real Madrid", "Manchester City")

- **РПЛ (слева):**
  - Пока используются статические данные (Football-Data.org не предоставляет РПЛ бесплатно)
  - Даты будут динамическими (относительно текущей даты)

### 6. Проверка автоматического обновления

1. Откройте страницу футбола
2. Подождите 5 минут
3. В консоли браузера должны появиться новые сообщения о загрузке
4. Данные должны обновиться автоматически

### 7. Принудительное обновление кеша

Если нужно обновить данные немедленно:

```bash
curl -X POST https://your-app.up.railway.app/api/v1/football/refresh
```

Или через браузер откройте:
```
https://your-app.up.railway.app/api/v1/football/refresh
```

### 8. Возможные проблемы

**Проблема: Нет данных в ответе**

**Решение:**
- Проверьте логи на Railway - возможно API вернул ошибку
- Проверьте, что API ключ правильный
- Убедитесь, что сезон активен (матчи могут быть только в определенное время года)

**Проблема: Ошибка 429 (Too Many Requests)**

**Решение:**
- Football-Data.org ограничивает бесплатный план до 10 запросов в минуту
- Подождите минуту и попробуйте снова
- Или используйте платный план

**Проблема: Ошибка 403 (Forbidden)**

**Решение:**
- Проверьте правильность API ключа
- Убедитесь, что ключ активен на Football-Data.org

**Проблема: Данные не обновляются**

**Решение:**
- Проверьте кеш - данные кешируются на 5 минут
- Используйте endpoint `/football/refresh` для принудительного обновления
- Проверьте логи на наличие ошибок

### 9. Проверка через curl

```bash
# Получить все матчи
curl https://your-app.up.railway.app/api/v1/football/matches

# Получить только РПЛ
curl https://your-app.up.railway.app/api/v1/football/matches?league=RPL

# Получить только европейские
curl https://your-app.up.railway.app/api/v1/football/matches?league=CL
```

### 10. Что должно работать

✅ Загрузка данных из API  
✅ Отображение реальных матчей Лиги Чемпионов  
✅ Автоматическое обновление каждые 5 минут  
✅ Кеширование для оптимизации  
✅ Обработка ошибок с fallback на статические данные  
✅ Логирование для отладки  

### 11. Следующие шаги

Если все работает:
1. Данные будут автоматически обновляться каждые 5 минут
2. При открытии страницы данные загружаются сразу
3. При ошибке API используются статические данные

Если нужно добавить больше лиг или улучшить данные РПЛ:
- Рассмотрите интеграцию с альтернативными API
- Или используйте платный план Football-Data.org
