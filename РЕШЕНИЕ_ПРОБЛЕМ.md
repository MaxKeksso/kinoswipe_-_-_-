# Решение проблем KinoSwipe

## 1. Подключение к PostgreSQL базе данных

### Данные для подключения:
```
Host: localhost
Port: 5432
User: kinoswipe
Password: kinoswipe123
Database: kinoswipe
```

### Подключение через Docker:
```bash
docker exec -it kinoswipe_db psql -U kinoswipe -d kinoswipe
```

### Проверка наличия фильмов:
```sql
SELECT COUNT(*) FROM movies;
SELECT id, title, year FROM movies LIMIT 10;
```

## 2. Исправление пустой библиотеки фильмов

### Проблема:
Библиотека показывает "0 фильмов", хотя фильмы есть в БД.

### Решение:
1. Проверьте, что фильмы есть в БД (см. выше)
2. Проверьте API напрямую: `http://localhost:8080/api/v1/movies`
3. Откройте консоль браузера (F12) и проверьте ошибки
4. Убедитесь, что backend запущен и доступен

### Добавление фильмов:
1. **Через админ-панель:**
   - Войдите как админ (admin@example.com / admin123)
   - Перейдите в раздел "Фильмы"
   - Заполните форму и добавьте фильм

2. **Через SQL:**
```sql
INSERT INTO movies (id, title, poster_url, year, duration, genre, description)
VALUES (
  gen_random_uuid(),
  'Название фильма',
  'https://image.tmdb.org/t/p/w500/...',
  2024,
  120,
  '["боевик", "фантастика"]',
  'Описание фильма'
);
```

## 3. Алгоритм мэтча для двух пользователей

### Как работает:
1. Два пользователя заходят в комнату
2. Хост нажимает "Начать выбор фильмов"
3. Оба пользователя видят одинаковые фильмы для свайпов
4. Когда **оба** пользователя лайкают один и тот же фильм (swipe right), создается мэтч
5. Появляется анимация "ЭТО МЭТЧ!" и страница со ссылками

### Логика алгоритма:
- Проверяется количество лайков (swipe right) для каждого фильма
- Проверяется, что каждый участник комнаты лайкнул фильм
- Если количество лайков >= количеству участников → создается мэтч
- Для двух пользователей нужно минимум 2 лайка от разных пользователей

### Проверка мэтчей в БД:
```sql
-- Посмотреть все мэтчи
SELECT m.*, r.code as room_code, mv.title as movie_title
FROM matches m
JOIN rooms r ON m.room_id = r.id
JOIN movies mv ON m.movie_id = mv.id;

-- Посмотреть свайпы для проверки
SELECT s.*, u.username, mv.title
FROM swipes s
JOIN users u ON s.user_id = u.id
JOIN movies mv ON s.movie_id = mv.id
WHERE s.direction = 'right'
ORDER BY s.created_at DESC;
```

## 4. Проверка работы системы

### Шаги для тестирования:
1. **Запустите приложение:**
   ```bash
   docker-compose up -d
   ```

2. **Откройте два браузера (или инкогнито):**
   - Браузер 1: создайте комнату
   - Браузер 2: присоединитесь по коду

3. **Проверьте экран ожидания:**
   - Оба должны видеть список участников
   - Хост видит кнопку "Начать выбор"

4. **Начните свайпы:**
   - Хост нажимает "Начать выбор"
   - Оба видят одинаковые фильмы
   - Оба лайкают один фильм → должен появиться мэтч

## 5. Отладка

### Проверка логов:
```bash
# Логи backend
docker logs kinoswipe_app

# Логи frontend
docker logs kinoswipe_frontend

# Логи PostgreSQL
docker logs kinoswipe_db
```

### Проверка API:
```bash
# Все фильмы
curl http://localhost:8080/api/v1/movies

# Все комнаты
curl http://localhost:8080/api/v1/rooms

# Участники комнаты
curl -H "X-User-ID: <user_id>" http://localhost:8080/api/v1/rooms/<room_id>/members
```

## 6. Частые проблемы

### Библиотека пустая:
- Проверьте, что фильмы есть в БД
- Проверьте, что API возвращает данные
- Проверьте консоль браузера на ошибки

### Мэтчи не создаются:
- Убедитесь, что оба пользователя лайкнули фильм
- Проверьте логи backend на ошибки
- Проверьте таблицу `swipes` в БД

### Комната не запускается:
- Убедитесь, что минимум 2 участника в комнате
- Проверьте, что хост нажимает кнопку "Начать выбор"
- Проверьте статус комнаты в БД: `SELECT * FROM rooms WHERE code = 'XXXXXX';`
