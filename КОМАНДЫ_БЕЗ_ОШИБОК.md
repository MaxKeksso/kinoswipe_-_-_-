# –ö–æ–º–∞–Ω–¥—ã –±–µ–∑ –æ—à–∏–±–∫–∏ TTY

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏):

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

**–í–∞—Ä–∏–∞–Ω—Ç –ê (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç):**
```bash
cd /Users/maksimzagorodnev/Downloads/kinoswipe
bash apply_migration.sh
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë (–≤—Ä—É—á–Ω—É—é —Å —Ñ–ª–∞–≥–æ–º -T):**
```bash
docker-compose exec -T postgres psql -U kinoswipe -d kinoswipe -f - <<'EOF'
ALTER TABLE users ADD COLUMN IF NOT EXISTS password_hash VARCHAR(255);

CREATE TABLE IF NOT EXISTS premieres (
    id UUID PRIMARY KEY,
    movie_id UUID,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    poster_url TEXT,
    release_date TIMESTAMP,
    is_active BOOLEAN NOT NULL DEFAULT true,
    position VARCHAR(10) NOT NULL CHECK (position IN ('left', 'right')),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (movie_id) REFERENCES movies(id) ON DELETE SET NULL
);

CREATE INDEX IF NOT EXISTS idx_premieres_is_active ON premieres(is_active);
CREATE INDEX IF NOT EXISTS idx_premieres_position ON premieres(position);
CREATE INDEX IF NOT EXISTS idx_premieres_release_date ON premieres(release_date);

CREATE TABLE IF NOT EXISTS match_links (
    id UUID PRIMARY KEY,
    match_id UUID NOT NULL,
    platform VARCHAR(50) NOT NULL,
    url TEXT NOT NULL,
    title VARCHAR(255) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (match_id) REFERENCES matches(id) ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_match_links_match_id ON match_links(match_id);
CREATE INDEX IF NOT EXISTS idx_match_links_platform ON match_links(platform);

CREATE TRIGGER update_premieres_updated_at BEFORE UPDATE ON premieres
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_match_links_updated_at BEFORE UPDATE ON match_links
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
EOF
```

**–í–∞—Ä–∏–∞–Ω—Ç –í (—á–µ—Ä–µ–∑ —Ñ–∞–π–ª):**
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª migration.sql —Å SQL –∫–æ–º–∞–Ω–¥–∞–º–∏
docker-compose exec -T postgres psql -U kinoswipe -d kinoswipe < migration.sql
```

### 2. –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞:

**–í–∞—Ä–∏–∞–Ω—Ç –ê (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç):**
```bash
bash create_admin.sh
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë (–≤—Ä—É—á–Ω—É—é —Å —Ñ–ª–∞–≥–æ–º -T):**
```bash
docker-compose exec -T postgres psql -U kinoswipe -d kinoswipe <<'EOF'
INSERT INTO users (id, username, email, password_hash, user_type)
VALUES (
    gen_random_uuid(),
    'admin',
    'admin@kinoswipe.ru',
    '$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy',
    'admin'
)
ON CONFLICT (email) DO NOTHING;
EOF
```

### 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
docker-compose build app frontend
docker-compose up -d
```

---

## üöÄ –í—Å–µ –≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ:

```bash
cd /Users/maksimzagorodnev/Downloads/kinoswipe

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
bash apply_migration.sh

# –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞
bash create_admin.sh

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose build app frontend
docker-compose up -d
```

---

## üìù –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
cd /Users/maksimzagorodnev/Downloads/kinoswipe
./–ü–†–ò–ú–ï–ù–ò–¢–¨_–ò–ó–ú–ï–ù–ï–ù–ò–Ø.sh
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
docker-compose exec -T postgres psql -U kinoswipe -d kinoswipe -c "\dt"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥–º–∏–Ω–∞
docker-compose exec -T postgres psql -U kinoswipe -d kinoswipe -c "SELECT username, email, user_type FROM users WHERE user_type = 'admin';"
```

---

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ `-T` –≤ –∫–æ–º–∞–Ω–¥–µ `docker-compose exec -T` –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è TTY!
